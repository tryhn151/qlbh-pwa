# ğŸ“‹ HÆ¯á»šNG DáºªN WORKFLOW Má»šI - QUáº¢N LÃ THANH TOÃN THEO ÄÆ N HÃ€NG

## ğŸ”„ **WORKFLOW NGHIá»†P Vá»¤ Má»šI**

### **1. Tá»•ng quan thay Ä‘á»•i**
- âŒ **Bá» Ä‘i**: Tab Thanh toÃ¡n riÃªng biá»‡t
- âœ… **ThÃªm má»›i**: Thanh toÃ¡n tÃ­ch há»£p trong tab Chuyáº¿n hÃ ng
- âœ… **Cáº£i thiá»‡n**: Quáº£n lÃ½ cÃ´ng ná»£ theo tá»«ng Ä‘Æ¡n hÃ ng cá»¥ thá»ƒ
- âœ… **Tá»± Ä‘á»™ng**: Cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng vÃ  chuyáº¿n hÃ ng

### **2. Quy trÃ¬nh liÃªn káº¿t Ä‘Æ¡n hÃ ng**

#### **BÆ°á»›c 1: Táº¡o chuyáº¿n hÃ ng**
```
Tab Chuyáº¿n hÃ ng â†’ ThÃªm chuyáº¿n má»›i
- TÃªn chuyáº¿n: [Nháº­p tÃªn]
- NgÃ y: [Chá»n ngÃ y]
- Tráº¡ng thÃ¡i: Äang chuáº©n bá»‹ (máº·c Ä‘á»‹nh)
```

#### **BÆ°á»›c 2: LiÃªn káº¿t Ä‘Æ¡n hÃ ng**
```
Chi tiáº¿t chuyáº¿n hÃ ng â†’ Tab "LiÃªn káº¿t Ä‘Æ¡n hÃ ng"
- Chá»n Ä‘Æ¡n hÃ ng cÃ³ tráº¡ng thÃ¡i: "Má»›i" hoáº·c "Chá» xá»­ lÃ½"
- Sau khi liÃªn káº¿t â†’ Tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng: "Äang xá»­ lÃ½"
- ÄÆ¡n hÃ ng Ä‘Æ°á»£c gÃ¡n vÃ o chuyáº¿n hÃ ng
```

#### **BÆ°á»›c 3: Quáº£n lÃ½ thanh toÃ¡n**
```
Chi tiáº¿t chuyáº¿n hÃ ng â†’ Tab "ÄÆ¡n hÃ ng & Thanh toÃ¡n"
- Xem danh sÃ¡ch Ä‘Æ¡n hÃ ng Ä‘Ã£ liÃªn káº¿t
- Theo dÃµi: Tá»•ng tiá»n | ÄÃ£ thanh toÃ¡n | CÃ²n ná»£
- Thá»±c hiá»‡n thanh toÃ¡n tá»«ng Ä‘Æ¡n hÃ ng
```

## ğŸ’³ **CHI TIáº¾T QUY TRÃŒNH THANH TOÃN**

### **Thanh toÃ¡n tá»«ng Ä‘Æ¡n hÃ ng**

#### **BÆ°á»›c 1: Má»Ÿ modal thanh toÃ¡n**
```
Tab "ÄÆ¡n hÃ ng & Thanh toÃ¡n" â†’ NÃºt "Thanh toÃ¡n" (vá»›i Ä‘Æ¡n hÃ ng cÃ²n ná»£)
```

#### **BÆ°á»›c 2: Nháº­p thÃ´ng tin thanh toÃ¡n**
```
ğŸ“‹ Form thanh toÃ¡n:
- KhÃ¡ch hÃ ng: [Hiá»ƒn thá»‹ tá»± Ä‘á»™ng]
- Tá»•ng tiá»n Ä‘Æ¡n hÃ ng: [Hiá»ƒn thá»‹ tá»± Ä‘á»™ng]
- ÄÃ£ thanh toÃ¡n: [Hiá»ƒn thá»‹ sá»‘ tiá»n Ä‘Ã£ thanh toÃ¡n trÆ°á»›c Ä‘Ã³]
- CÃ²n ná»£: [Hiá»ƒn thá»‹ sá»‘ tiá»n cÃ²n láº¡i]
- Sá»‘ tiá»n thanh toÃ¡n: [Nháº­p sá»‘ tiá»n] â­ Tá»I ÄA = CÃ²n ná»£
- NgÃ y thanh toÃ¡n: [Chá»n ngÃ y]
- Ghi chÃº: [TÃ¹y chá»n]
```

#### **BÆ°á»›c 3: XÃ¡c nháº­n thanh toÃ¡n**
```
âœ… Há»‡ thá»‘ng tá»± Ä‘á»™ng:
- Cáº­p nháº­t sá»‘ tiá»n Ä‘Ã£ thanh toÃ¡n cho Ä‘Æ¡n hÃ ng
- LÆ°u lá»‹ch sá»­ thanh toÃ¡n
- Náº¿u thanh toÃ¡n Ä‘á»§ â†’ Chuyá»ƒn tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng: "ThÃ nh cÃ´ng"
- Kiá»ƒm tra táº¥t cáº£ Ä‘Æ¡n hÃ ng trong chuyáº¿n
- Náº¿u táº¥t cáº£ Ä‘Æ¡n hÃ ng "ThÃ nh cÃ´ng" â†’ Chuyá»ƒn tráº¡ng thÃ¡i chuyáº¿n hÃ ng: "ÄÃ£ giao"
```

## ğŸ“Š **LUá»’NG TRáº NG THÃI**

### **Tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng**
```
Má»›i/Chá» xá»­ lÃ½ â†’ [LiÃªn káº¿t] â†’ Äang xá»­ lÃ½ â†’ [Thanh toÃ¡n Ä‘á»§] â†’ ThÃ nh cÃ´ng
```

### **Tráº¡ng thÃ¡i chuyáº¿n hÃ ng**
```
Äang chuáº©n bá»‹ â†’ [CÃ³ Ä‘Æ¡n hÃ ng] â†’ Äang thá»±c hiá»‡n â†’ [Táº¥t cáº£ Ä‘Æ¡n "ThÃ nh cÃ´ng"] â†’ ÄÃ£ giao
```

## ğŸ”§ **CÃ”NG Cá»¤ DEBUG VÃ€ TEST**

### **Debug commands (Console)**
```javascript
// Test workflow hoÃ n chÃ­nh
testNewBusinessWorkflow()

// Test riÃªng tá»«ng pháº§n
testOrderLinkingAndRevenue()
testNewPaymentWorkflow()

// Debug quick
systemHealthCheck()
```

### **Kháº¯c phá»¥c sá»± cá»‘ nhanh**
```javascript
// Fix dropdown issues
fixProductSupplierDropdown()

// Test liÃªn káº¿t Ä‘Æ¡n hÃ ng
quickTestOrderLinking()

// Reload toÃ n bá»™ dá»¯ liá»‡u
forceReloadAll()
```

## ğŸ“ˆ **THÃ”NG TIN HIá»‚N THá»Š**

### **Chi tiáº¿t chuyáº¿n hÃ ng - Cards tá»•ng quan**
```
ğŸŸ¦ Tá»•ng doanh thu: [Tá»•ng giÃ¡ trá»‹ táº¥t cáº£ Ä‘Æ¡n hÃ ng Ä‘Ã£ liÃªn káº¿t]
ğŸŸ¥ Tá»•ng chi phÃ­: [Chi phÃ­ xÄƒng dáº§u, phÃ­ Ä‘Æ°á»ng, Äƒn uá»‘ng, khÃ¡c]
ğŸŸ© Lá»£i nhuáº­n gá»™p: [Doanh thu - Chi phÃ­] 
ğŸŸ¨ ÄÃ£ thu: [Tá»•ng sá»‘ tiá»n Ä‘Ã£ thanh toÃ¡n]
```

### **Báº£ng Ä‘Æ¡n hÃ ng & thanh toÃ¡n**
```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID  â”‚ KhÃ¡ch hÃ ng   â”‚ NgÃ y Ä‘áº·t â”‚ Tráº¡ng thÃ¡iâ”‚ Tá»•ng tiá»nâ”‚ ÄÃ£ thanh toÃ¡nâ”‚ CÃ²n ná»£   â”‚ Thao tÃ¡c â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 001 â”‚ KhÃ¡ch A      â”‚ 01/12    â”‚ Äang xá»­ lÃ½â”‚ 500K     â”‚ 300K        â”‚ 200K     â”‚ [ğŸ’³][ğŸ”—][ğŸ‘] â”‚
â”‚ 002 â”‚ KhÃ¡ch B      â”‚ 02/12    â”‚ ThÃ nh cÃ´ngâ”‚ 800K     â”‚ 800K        â”‚ 0        â”‚ [ğŸ”—][ğŸ‘]    â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ğŸ’³] = Thanh toÃ¡n | [ğŸ”—] = Há»§y liÃªn káº¿t | [ğŸ‘] = Chi tiáº¿t
```

## âš¡ **TÃNH NÄ‚NG Ná»”I Báº¬T**

### **1. Thanh toÃ¡n linh hoáº¡t**
- âœ… Thanh toÃ¡n tá»«ng pháº§n
- âœ… Theo dÃµi cÃ´ng ná»£ realtime
- âœ… Lá»‹ch sá»­ thanh toÃ¡n chi tiáº¿t

### **2. Tá»± Ä‘á»™ng hÃ³a**
- âœ… Auto cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng
- âœ… Auto cáº­p nháº­t tráº¡ng thÃ¡i chuyáº¿n hÃ ng
- âœ… Auto tÃ­nh toÃ¡n doanh thu, lá»£i nhuáº­n

### **3. BÃ¡o cÃ¡o tÃ­ch há»£p**
- âœ… Doanh thu theo chuyáº¿n
- âœ… CÃ´ng ná»£ theo khÃ¡ch hÃ ng  
- âœ… Lá»£i nhuáº­n gá»™p realtime

## ğŸš¨ **LÆ¯U Ã QUAN TRá»ŒNG**

### **â— RÃ ng buá»™c nghiá»‡p vá»¥**
1. **KhÃ´ng thá»ƒ thanh toÃ¡n quÃ¡ sá»‘ tiá»n cÃ²n ná»£**
2. **Chá»‰ Ä‘Æ¡n hÃ ng "Äang xá»­ lÃ½" má»›i cÃ³ thá»ƒ thanh toÃ¡n**
3. **ÄÆ¡n hÃ ng "ThÃ nh cÃ´ng" khÃ´ng thá»ƒ há»§y liÃªn káº¿t**
4. **Chuyáº¿n hÃ ng "ÄÃ£ giao" khÃ´ng thá»ƒ thÃªm Ä‘Æ¡n hÃ ng má»›i**

### **â— Dá»¯ liá»‡u quan trá»ng**
- `paymentReceived`: Sá»‘ tiá»n Ä‘Ã£ thanh toÃ¡n cho Ä‘Æ¡n hÃ ng
- `deliveredTripId`: ID chuyáº¿n hÃ ng liÃªn káº¿t vá»›i Ä‘Æ¡n hÃ ng
- `payments`: Báº£ng lÆ°u lá»‹ch sá»­ thanh toÃ¡n chi tiáº¿t

### **â— KhÃ¡c biá»‡t vá»›i workflow cÅ©**
- **CÅ©**: Thanh toÃ¡n tá»•ng quÃ¡t cho khÃ¡ch hÃ ng
- **Má»›i**: Thanh toÃ¡n cá»¥ thá»ƒ theo tá»«ng Ä‘Æ¡n hÃ ng
- **CÅ©**: Theo dÃµi cÃ´ng ná»£ chung
- **Má»›i**: Theo dÃµi cÃ´ng ná»£ theo Ä‘Æ¡n hÃ ng cá»¥ thá»ƒ

## ğŸ¯ **Ká»Šch báº£n sá»­ dá»¥ng máº«u**

### **Ká»‹ch báº£n 1: Chuyáº¿n hÃ ng hoÃ n táº¥t**
```
1. Táº¡o chuyáº¿n hÃ ng "Giao hÃ ng ngÃ y 15/12"
2. LiÃªn káº¿t 3 Ä‘Æ¡n hÃ ng: A(500K), B(800K), C(300K)
3. Thá»±c hiá»‡n giao hÃ ng
4. Thu tiá»n:
   - ÄÆ¡n A: Thu 300K (cÃ²n ná»£ 200K)
   - ÄÆ¡n B: Thu Ä‘á»§ 800K â†’ Tráº¡ng thÃ¡i "ThÃ nh cÃ´ng"  
   - ÄÆ¡n C: Thu Ä‘á»§ 300K â†’ Tráº¡ng thÃ¡i "ThÃ nh cÃ´ng"
5. Äi thu ná»£ Ä‘Æ¡n A: Thu thÃªm 200K â†’ Tráº¡ng thÃ¡i "ThÃ nh cÃ´ng"
6. Táº¥t cáº£ Ä‘Æ¡n "ThÃ nh cÃ´ng" â†’ Chuyáº¿n hÃ ng chuyá»ƒn thÃ nh "ÄÃ£ giao"
```

### **Ká»‹ch báº£n 2: Quáº£n lÃ½ cÃ´ng ná»£**
```
1. Xem tab "CÃ´ng ná»£" Ä‘á»ƒ biáº¿t khÃ¡ch nÃ o Ä‘ang ná»£
2. VÃ o chi tiáº¿t chuyáº¿n hÃ ng tÆ°Æ¡ng á»©ng
3. Xem tab "ÄÆ¡n hÃ ng & Thanh toÃ¡n" 
4. Thanh toÃ¡n tá»«ng Ä‘Æ¡n hÃ ng cÃ³ cÃ´ng ná»£
5. Há»‡ thá»‘ng tá»± Ä‘á»™ng cáº­p nháº­t tráº¡ng thÃ¡i
```

---

**ğŸ’¡ Tip**: Sá»­ dá»¥ng cÃ¡c lá»‡nh debug trong Console Ä‘á»ƒ kiá»ƒm tra vÃ  kháº¯c phá»¥c sá»± cá»‘ nhanh chÃ³ng! 